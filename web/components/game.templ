package components

import (
	"fmt"
	datastar "github.com/starfederation/datastar/sdk/go"
)

templ GameBoard(gameState *GameState, gameLobby *GameLobby, sessionId string) {
	<div
		id="gameboard"
		class="grid grid-cols-3 grid-rows-3 gap-2 w-full max-w-[600px] aspect-square"
	>
		if gameState.Winner != "" {
			@GameWinner(sessionId, gameState, gameLobby)
		} else {
			for i, cell := range gameState.Board {
				@Cell(gameState.Id, cell, i, gameState, sessionId)
			}
		}
	</div>
}

templ Cell(id string, cell string, i int, gameState *GameState, sessionId string) {
	<button
		id={ "cell-" + fmt.Sprintf("%d", i) }
		class="w-full h-full bg-secondary border-base-content border-4 flex items-center justify-center text-5xl text-secondary-content font-bold cursor-pointer aspect-square transition-all duration-300"
		data-on-click={ datastar.PostSSE("/api/game/%s/toggle/%d", id, i) }
		if cell != "" {
			disabled
		}
	>
		{ cell }
	</button>
}

templ GameWinner(sessionId string, gameState *GameState, gameLobby *GameLobby) {
	<div
		class="absolute inset-0 flex flex-col items-center justify-center bg-green-500 bg-opacity-90 text-white z-10 p-6 rounded-lg"
		aria-live="assertive"
		role="dialog"
	>
		if (gameState.Winner == "TIE") {
			<h1 class="text-4xl sm:text-5xl font-extrabold mb-4 animate-bounce text-center">
				🤝 It's a Tie! 🤝
			</h1>
		} else {
			<h1 class="text-4xl sm:text-5xl font-extrabold mb-4 animate-bounce text-center">
				🎉 { gameState.Winner } Wins! 🎉
			</h1>
		}
		<div class="flex flex-col sm:flex-row gap-3 w-full max-w-[80%] sm:max-w-[60%] items-center justify-center">
			if (sessionId == gameLobby.HostId) {
				<button
					class="btn btn-primary w-full sm:w-auto px-6 py-3"
					data-on-click={ datastar.PostSSE("/api/game/%s/reset", gameState.Id) }
				>
					Play Again
				</button>
			}
			if (sessionId == gameLobby.HostId) {
				<a class="btn btn-secondary w-full sm:w-auto px-6 py-3" href="/">
					Back to Dashboard
				</a>
			} else {
				<button
					class="btn btn-secondary w-full sm:w-auto px-6 py-3"
					data-on-click={ datastar.PostSSE("/api/game/%s/leave", gameState.Id) }
				>
					Back to Dashboard
				</button>
			}
		</div>
	</div>
}
